<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloquito - Assistente de Voz Universal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Annyang.js para melhor compatibilidade -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #2c7744 0%, #1e5631 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.12);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        h1 {
            color: #fff;
            font-size: 26px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #FFD700;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .compatibility-info {
            background: rgba(76, 175, 80, 0.2);
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid rgba(76, 175, 80, 0.3);
            text-align: center;
            font-size: 13px;
        }
        
        .compatibility-info.warning {
            background: rgba(255, 152, 0, 0.2);
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .compatibility-info.error {
            background: rgba(244, 67, 54, 0.2);
            border-color: rgba(244, 67, 54, 0.3);
        }
        
        .status-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f44336;
            position: relative;
        }
        
        .status-indicator.listening {
            background: #4CAF50;
            animation: pulse 1.5s infinite;
        }
        
        .status-indicator.processing {
            background: #FF9800;
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-text {
            font-weight: bold;
            font-size: 16px;
        }
        
        .volume-container {
            margin: 15px 0 25px;
        }
        
        .volume-indicator {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
        }
        
        .volume-bar {
            height: 100%;
            background: #FFD700;
            width: 0%;
            transition: width 0.1s ease-out;
            border-radius: 5px;
        }
        
        .volume-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        
        .btn {
            background: #FFD700;
            color: #333;
            border: none;
            padding: 16px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
        }
        
        .btn:hover {
            background: #FFC107;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn.talk {
            background: #FF5722;
            color: white;
            padding: 20px;
            font-size: 18px;
        }
        
        .btn.talk:hover {
            background: #E64A19;
        }
        
        .btn.talk.recording {
            background: #E64A19;
            animation: pulse 1s infinite;
        }
        
        .btn.talk i {
            font-size: 24px;
        }
        
        .method-selector {
            display: flex;
            gap: 8px;
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 25px;
        }
        
        .method-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .method-btn.active {
            background: #FFD700;
            color: #333;
        }
        
        .conversation {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }
        
        .message {
            margin: 12px 0;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInMessage 0.3s forwards;
            position: relative;
            max-width: 85%;
        }

        @keyframes fadeInMessage {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: linear-gradient(135deg, #1E88E5 0%, #0D47A1 100%);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .commands {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }
        
        .commands h3 {
            margin-top: 0;
            color: #FFD700;
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }
        
        .command-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .command-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .mic-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Responsividade */
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .btn {
                padding: 14px;
                font-size: 15px;
            }
            
            .btn.talk {
                padding: 18px;
            }
            
            .message {
                font-size: 14px;
                padding: 10px 14px;
            }
            
            .commands-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .command-item {
                font-size: 12px;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <i class="fas fa-microphone mic-icon"></i>
            <h1>Bloquito</h1>
            <div class="subtitle">Assistente de Voz Universal</div>
        </div>
        
        <div class="compatibility-info" id="compatibilityInfo">
            <i class="fas fa-info-circle"></i>
            Verificando compatibilidade...
        </div>
        
        <div class="method-selector">
            <button class="method-btn active" id="webSpeechBtn">Web Speech</button>
            <button class="method-btn" id="annyangBtn">Annyang</button>
            <button class="method-btn" id="recordBtn">Gravação</button>
        </div>
        
        <div class="status-container">
            <div class="status-indicator" id="statusIndicator"></div>
            <div class="status-text" id="statusText">Não está ouvindo</div>
        </div>
        
        <div class="volume-container">
            <div class="volume-indicator">
                <div class="volume-bar" id="volumeBar"></div>
            </div>
            <div class="volume-label">
                <span>Baixo</span>
                <span>Alto</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="startBtn">
                <i class="fas fa-play"></i> Iniciar Reconhecimento
            </button>
            <button class="btn" id="stopBtn" disabled>
                <i class="fas fa-stop"></i> Parar Reconhecimento
            </button>
            <button class="btn talk" id="talkButton">
                <i class="fas fa-microphone"></i> Segurar para Falar
            </button>
        </div>

        <div class="conversation" id="conversation">
            <div class="message bot-message">
                Olá! Eu sou o Bloquito. Escolha um método de reconhecimento acima e comece a conversar!
            </div>
        </div>
        
        <div class="commands">
            <h3>Comandos Reconhecidos</h3>
            <div class="commands-grid">
                <div class="command-item" onclick="assistant.simulateCommand('oi')">Oi / Olá</div>
                <div class="command-item" onclick="assistant.simulateCommand('bom dia')">Bom dia / Boa tarde</div>
                <div class="command-item" onclick="assistant.simulateCommand('como você está')">Como você está?</div>
                <div class="command-item" onclick="assistant.simulateCommand('quem é você')">Quem é você?</div>
                <div class="command-item" onclick="assistant.simulateCommand('que horas são')">Que horas são?</div>
                <div class="command-item" onclick="assistant.simulateCommand('o que é bloco mais')">O que é Bloco+?</div>
                <div class="command-item" onclick="assistant.simulateCommand('o que é steamaker')">O que é STEAMAKER?</div>
                <div class="command-item" onclick="assistant.simulateCommand('fale sobre o corellaser')">Fale sobre o CorelLASER</div>
            </div>
        </div>
    </div>

    <script>
        class UniversalVoiceAssistant {
            constructor() {
                this.currentMethod = 'webspeech';
                this.recognition = null;
                this.isListening = false;
                this.recognitionActiveByUser = false;
                this.audioContext = null;
                this.microphoneStream = null;
                this.analyser = null;
                this.dataArray = null;
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                
                this.initializeElements();
                this.checkCompatibility();
                this.setupEventListeners();
                this.setupAudioMonitoring();
            }
            
            initializeElements() {
                this.statusIndicator = document.getElementById('statusIndicator');
                this.statusText = document.getElementById('statusText');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.talkButton = document.getElementById('talkButton');
                this.conversationEl = document.getElementById('conversation');
                this.volumeBar = document.getElementById('volumeBar');
                this.compatibilityInfo = document.getElementById('compatibilityInfo');
                this.webSpeechBtn = document.getElementById('webSpeechBtn');
                this.annyangBtn = document.getElementById('annyangBtn');
                this.recordBtn = document.getElementById('recordBtn');
            }
            
            checkCompatibility() {
                const hasWebSpeech = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                const hasAnnyang = typeof annyang !== 'undefined';
                const hasMediaRecorder = 'MediaRecorder' in window;
                
                let message = '';
                let className = 'compatibility-info';
                
                if (hasWebSpeech && hasAnnyang && hasMediaRecorder) {
                    message = '<i class="fas fa-check-circle"></i> Todos os métodos de reconhecimento disponíveis!';
                    className += '';
                } else if (hasWebSpeech || hasAnnyang) {
                    message = '<i class="fas fa-exclamation-triangle"></i> Reconhecimento parcialmente disponível';
                    className += ' warning';
                } else {
                    message = '<i class="fas fa-times-circle"></i> Reconhecimento limitado - use gravação manual';
                    className += ' error';
                }
                
                this.compatibilityInfo.innerHTML = message;
                this.compatibilityInfo.className = className;
                
                // Desabilita botões não suportados
                if (!hasWebSpeech) this.webSpeechBtn.disabled = true;
                if (!hasAnnyang) this.annyangBtn.disabled = true;
                if (!hasMediaRecorder) this.recordBtn.disabled = true;
            }
            
            async setupAudioMonitoring() {
                try {
                    this.microphoneStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const source = this.audioContext.createMediaStreamSource(this.microphoneStream);
                    this.analyser = this.audioContext.createAnalyser();
                    
                    this.analyser.fftSize = 256;
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    
                    source.connect(this.analyser);
                    this.monitorAudio();
                    
                    this.setupCurrentMethod();
                } catch (error) {
                    console.error('Erro ao acessar microfone:', error);
                    this.handleMicrophoneError(error);
                }
            }
            
            handleMicrophoneError(error) {
                let errorMessage = 'Erro ao acessar microfone.';
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'Permissão de microfone negada. Atualize as permissões nas configurações do navegador.';
                    this.statusText.textContent = 'Permissão negada';
                    this.statusIndicator.style.backgroundColor = '#FF9800';
                }
                this.addMessage(`Bloquito: ${errorMessage}`, 'bot');
                this.startBtn.disabled = true;
                this.talkButton.disabled = true;
            }
            
            monitorAudio() {
                if (!this.analyser) return;
                
                this.analyser.getByteFrequencyData(this.dataArray);
                let sum = 0;
                for (let i = 0; i < this.dataArray.length; i++) {
                    sum += this.dataArray[i];
                }
                const average = sum / this.dataArray.length;
                
                this.volumeBar.style.width = Math.min(average * 2, 100) + '%';
                
                requestAnimationFrame(() => this.monitorAudio());
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.startListening());
                this.stopBtn.addEventListener('click', () => this.stopListening());
                
                this.talkButton.addEventListener('mousedown', () => this.startRecording());
                this.talkButton.addEventListener('mouseup', () => this.stopRecording());
                this.talkButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startRecording();
                });
                this.talkButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.stopRecording();
                });
                
                // Method selector
                this.webSpeechBtn.addEventListener('click', () => this.switchMethod('webspeech'));
                this.annyangBtn.addEventListener('click', () => this.switchMethod('annyang'));
                this.recordBtn.addEventListener('click', () => this.switchMethod('recording'));
            }
            
            switchMethod(method) {
                this.stopListening();
                this.currentMethod = method;
                
                // Update UI
                document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
                if (method === 'webspeech') this.webSpeechBtn.classList.add('active');
                else if (method === 'annyang') this.annyangBtn.classList.add('active');
                else if (method === 'recording') this.recordBtn.classList.add('active');
                
                this.setupCurrentMethod();
                this.addMessage(`Bloquito: Método alterado para ${this.getMethodName(method)}`, 'bot');
            }
            
            getMethodName(method) {
                switch(method) {
                    case 'webspeech': return 'Web Speech API';
                    case 'annyang': return 'Annyang.js';
                    case 'recording': return 'Gravação Manual';
                    default: return 'Desconhecido';
                }
            }
            
            setupCurrentMethod() {
                switch(this.currentMethod) {
                    case 'webspeech':
                        this.setupWebSpeechRecognition();
                        break;
                    case 'annyang':
                        this.setupAnnyangRecognition();
                        break;
                    case 'recording':
                        // Método de gravação não precisa de setup especial
                        break;
                }
            }
            
            setupWebSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = 'pt-BR';
                
                this.recognition.onstart = () => this.onStart();
                this.recognition.onresult = (event) => this.onWebSpeechResult(event);
                this.recognition.onerror = (event) => this.onError(event);
                this.recognition.onend = () => this.onEnd();
            }
            
            setupAnnyangRecognition() {
                if (typeof annyang === 'undefined') return;
                
                // Define comandos para Annyang
                const commands = {
                    '*text': (text) => {
                        this.addMessage(`Você: ${text}`, 'user');
                        this.processCommand(text.toLowerCase());
                    }
                };
                
                annyang.addCommands(commands);
                annyang.setLanguage('pt-BR');
                
                // Callbacks do Annyang
                annyang.addCallback('start', () => this.onStart());
                annyang.addCallback('end', () => this.onEnd());
                annyang.addCallback('error', (error) => this.onError(error));
            }
            
            startListening() {
                if (!this.microphoneStream) return;
                
                this.recognitionActiveByUser = true;
                
                switch(this.currentMethod) {
                    case 'webspeech':
                        if (this.recognition) {
                            try {
                                this.recognition.start();
                            } catch (error) {
                                this.handleRecognitionError(error);
                            }
                        }
                        break;
                    case 'annyang':
                        if (typeof annyang !== 'undefined') {
                            annyang.start();
                        }
                        break;
                    case 'recording':
                        this.addMessage('Bloquito: Modo gravação ativo. Use "Segurar para Falar" para gravar comandos.', 'bot');
                        this.updateStatus('Modo gravação ativo', 'listening');
                        break;
                }
            }
            
            stopListening() {
                this.recognitionActiveByUser = false;
                
                switch(this.currentMethod) {
                    case 'webspeech':
                        if (this.recognition) {
                            this.recognition.stop();
                        }
                        break;
                    case 'annyang':
                        if (typeof annyang !== 'undefined') {
                            annyang.abort();
                        }
                        break;
                    case 'recording':
                        this.updateStatus('Não está ouvindo', 'not-listening');
                        break;
                }
            }
            
            startRecording() {
                if (!this.microphoneStream) return;
                
                this.audioChunks = [];
                this.mediaRecorder = new MediaRecorder(this.microphoneStream);
                
                this.mediaRecorder.ondataavailable = (event) => {
                    this.audioChunks.push(event.data);
                };
                
                this.mediaRecorder.onstop = () => {
                    this.processRecording();
                };
                
                this.mediaRecorder.start();
                this.isRecording = true;
                this.talkButton.classList.add('recording');
                this.updateStatus('Gravando...', 'processing');
            }
            
            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.talkButton.classList.remove('recording');
                }
            }
            
            processRecording() {
                // Simula processamento de áudio gravado
                const userInput = prompt('O que você disse? (Simulação de reconhecimento)');
                if (userInput && userInput.trim()) {
                    this.addMessage(`Você (gravado): ${userInput}`, 'user');
                    this.processCommand(userInput.toLowerCase());
                }
                this.updateStatus('Não está ouvindo', 'not-listening');
            }
            
            onStart() {
                this.isListening = true;
                this.updateStatus(`Ouvindo (${this.getMethodName(this.currentMethod)})...`, 'listening');
                this.startBtn.disabled = true;
                this.stopBtn.disabled = false;
            }
            
            onWebSpeechResult(event) {
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    }
                }
                
                finalTranscript = finalTranscript.trim();
                
                if (finalTranscript) {
                    this.addMessage(`Você: ${finalTranscript}`, 'user');
                    this.processCommand(finalTranscript.toLowerCase());
                }
            }
            
            onError(event) {
                if (event.error !== 'no-speech') {
                    console.error('Erro no reconhecimento:', event.error);
                    this.updateStatus('Erro no reconhecimento', 'error');
                }
            }
            
            onEnd() {
                this.isListening = false;
                this.updateStatus('Não está ouvindo', 'not-listening');
                this.startBtn.disabled = false;
                this.stopBtn.disabled = true;
                
                if (this.recognitionActiveByUser && this.currentMethod !== 'recording') {
                    setTimeout(() => {
                        if (this.recognitionActiveByUser) {
                            this.startListening();
                        }
                    }, 500);
                }
            }
            
            handleRecognitionError(error) {
                console.error('Erro ao iniciar reconhecimento:', error);
                this.addMessage('Bloquito: Não foi possível iniciar o reconhecimento. Tente outro método.', 'bot');
                this.updateStatus('Erro ao iniciar', 'error');
            }
            
            simulateCommand(command) {
                this.addMessage(`Você (clique): ${command}`, 'user');
                this.processCommand(command.toLowerCase());
            }
            
            processCommand(command) {
                let response = '';
                const normalizedCommand = this.normalizeText(command);
                const now = new Date();
                const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');

                // Comandos gerais
                if (normalizedCommand.includes('oi') || normalizedCommand.includes('ola') || 
                    normalizedCommand.includes('bom dia') || normalizedCommand.includes('boa tarde') || 
                    normalizedCommand.includes('boa noite')) {
                    response = 'Olá! Como posso te ajudar hoje?';
                } 
                else if (normalizedCommand.includes('tudo bem') || normalizedCommand.includes('como vai') || 
                         normalizedCommand.includes('voce esta bem')) {
                    response = 'Estou bem, obrigado! E você, como está?';
                } 
                else if (normalizedCommand.includes('quem e voce') || normalizedCommand.includes('como e seu nome') || 
                         normalizedCommand.includes('fale sobre voce') || normalizedCommand.includes('qual seu nome')) {
                    response = 'Eu sou o Bloquito, seu assistente de voz especializado em kits educacionais da Asthor Barden! Posso usar diferentes métodos de reconhecimento para melhor compatibilidade.';
                } 
                else if (normalizedCommand.includes('que horas') || normalizedCommand.includes('horas sao')) {
                    response = `Agora são ${timeString}.`;
                } 
                else if (normalizedCommand.includes('parar') || normalizedCommand.includes('pare')) {
                    response = 'Parando o reconhecimento. Até mais!';
                    this.stopListening();
                }
                // Perguntas específicas sobre produtos
                else if (normalizedCommand.includes('o que e bloco mais') || 
                         normalizedCommand.includes('fale sobre o bloco mais')) {
                    response = 'O Bloco+ é um kit de eletrônica pedagógica com componentes em blocos, facilitando conexões físicas de forma prática e modular. É focado em robótica, automação e eletrônica básica.';
                } 
                else if (normalizedCommand.includes('o que e steamaker')) {
                    response = 'O STEAMAKER é um kit similar ao Bloco+, mas com componentes organizados em módulos para maior flexibilidade em diferentes tipos de montagem.';
                } 
                else if (normalizedCommand.includes('bloco mais bot')) {
                    response = 'O Bloco+Bot é o microcontrolador central do kit, equipado com ESP32, sensores integrados e capacidade de controlar motores e LEDs.';
                } 
                else if (normalizedCommand.includes('corellaser')) {
                    response = 'O CorelLASER é um programa para controle de máquinas de corte a laser, usado em conjunto com os kits Asthor Barden para projetos educacionais.';
                }
                else if (normalizedCommand.includes('metodo') || normalizedCommand.includes('reconhecimento')) {
                    response = `Atualmente estou usando o método ${this.getMethodName(this.currentMethod)}. Você pode alternar entre Web Speech API, Annyang.js ou gravação manual para melhor compatibilidade.`;
                }
                // Fallback
                else {
                    response = 'Desculpe, não entendi. Posso ajudar com informações sobre Bloco+, STEAMAKER ou outros produtos da Asthor Barden. Você também pode tentar outro método de reconhecimento.';
                }

                if (response) {
                    setTimeout(() => {
                        this.addMessage(`Bloquito: ${response}`, 'bot');
                        this.speak(response);
                    }, 500);
                }
            }
            
            normalizeText(text) {
                return text
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^\w\s]/gi, '');
            }
            
            speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    
                    // Para o reconhecimento durante a fala
                    if (this.isListening) {
                        this.stopListening();
                    }
                    
                    utterance.onend = () => {
                        // Reinicia o reconhecimento se o usuário ainda estiver ativo
                        if (this.recognitionActiveByUser && this.currentMethod !== 'recording') {
                            setTimeout(() => {
                                if (this.recognitionActiveByUser) {
                                    this.startListening();
                                }
                            }, 300);
                        }
                    };
                    
                    speechSynthesis.speak(utterance);
                }
            }
            
            updateStatus(message, state) {
                this.statusText.textContent = message;
                
                this.statusIndicator.className = 'status-indicator';
                if (state === 'listening') {
                    this.statusIndicator.classList.add('listening');
                } else if (state === 'processing') {
                    this.statusIndicator.classList.add('processing');
                } else if (state === 'error') {
                    this.statusIndicator.style.backgroundColor = '#FF9800';
                    this.statusIndicator.style.animation = 'none';
                } else {
                    this.statusIndicator.style.backgroundColor = '#f44336';
                    this.statusIndicator.style.animation = 'none';
                }
            }
            
            addMessage(message, type) {
                const now = new Date();
                const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}-message`;
                messageEl.innerHTML = `
                    ${message}
                    <div class="message-time">${timeString}</div>
                `;
                
                this.conversationEl.appendChild(messageEl);
                this.conversationEl.scrollTop = this.conversationEl.scrollHeight;
            }
        }
        
        // Variável global para permitir acesso aos comandos clicáveis
        let assistant;
        
        // Inicializa o assistente quando a página carrega
        document.addEventListener('DOMContentLoaded', () => {
            assistant = new UniversalVoiceAssistant();
            
            // Adiciona mensagem de boas-vindas após um breve delay
            setTimeout(() => {
                assistant.addMessage('Bloquito: Sistema iniciado! Escolha um método de reconhecimento e comece a conversar.', 'bot');
            }, 1000);
        });
    </script>
</body>
</html>
