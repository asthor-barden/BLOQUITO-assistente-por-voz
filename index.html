                // Comandos espec√≠ficos dos produtos
                else if (normalizedCommand.includes('o que e bloco mais') || normalizedCommand.includes('fale sobre o bloco mais')) {
                    response = 'O Bloco+ √© um kit de eletr√¥nica pedag√≥gica da Asthor Barden, com componentes em blocos para facilitar conex√µes f√≠sicas de forma pr√°tica e modular. √â focado em rob√≥tica, automa√ß√£o e eletr√¥nica b√°sica.';
                } 
                else if (normalizedCommand.includes('o que e steamaker')) {
                    response = 'O STEAMAKER √© um kit similar ao Bloco+, mas com componentes organizados em m√≥dulos para maior flexibilidade em diferentes tipos de montagem.';
                } 
                else if (normalizedCommand.includes('bloco mais bot')) {
                    response = 'O Bloco+Bot √© o microcontrolador central do kit, equipado com ESP32, sensores integrados e capacidade de controlar motores e LEDs.';
                } 
                else if (normalizedCommand.includes('corellaser') || normalizedCommand.includes('fale sobre corellaser')) {
                    response = 'O CorelLASER √© um programa para controle de m√°quinas de corte a laser, usado em conjunto com os kits Asthor Barden para projetos educacionais.';
                }
                else if (normalizedCommand.includes('asthor barden')) {
                    response = 'A Asthor Barden √© a empresa respons√°vel pelo desenvolvimento dos kits Bloco+ e STEAMAKER, focados em eletr√¥nica pedag√≥gica e tecnologias educacionais.';
                }
                else {
                    response = 'Desculpe, n√£o entendi. Posso ajudar com informa√ß√µes sobre Bloco+, STEAMAKER ou outros produtos da Asthor Barden. Tente falar mais claramente ou use o bot√£o de teste.';
                }

                if (response) {
                    setTimeout(() => {
                        this.addMessage(`Bloquito: ${response}`, 'bot');
                        this.speak(response);
                    }, 300);
                }
            }
            
            normalizeText(text) {
                return text
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^\w\s]/gi, '');
            }
            
            speak(text) {
                if ('speechSynthesis' in window) {
                    // Para o reconhecimento durante a fala
                    const wasListening = this.isListening;
                    const wasContinuous = this.continuousMode;
                    
                    if (wasListening) {
                        this.stopRecognition();
                    }
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    
                    utterance.onstart = () => {
                        this.log('üîä Iniciando s√≠ntese de fala');
                        this.updateStatus('üîä Falando...', 'processing');
                    };
                    
                    utterance.onend = () => {
                        this.log('ÔøΩÔøΩ S√≠ntese de fala finalizada');
                        this.updateStatus('‚úÖ Pronto', 'ready');
                        
                        // Reinicia o reconhecimento se estava ativo
                        if (wasContinuous && this.continuousMode) {
                            setTimeout(() => {
                                this.startRecognition();
                            }, 500);
                        }
                    };
                    
                    utterance.onerror = (event) => {
                        this.log(`‚ùå Erro na s√≠ntese: ${event.error}`);
                    };
                    
                    speechSynthesis.speak(utterance);
                } else {
                    this.log('‚ùå S√≠ntese de fala n√£o suportada');
                }
            }
            
            updateStatus(message, state) {
                this.statusText.textContent = message;
                
                this.statusIndicator.className = 'status-indicator';
                this.statusIndicator.style.backgroundColor = '';
                this.statusIndicator.style.animation = '';
                
                switch(state) {
                    case 'listening':
                        this.statusIndicator.classList.add('listening');
                        break;
                    case 'processing':
                        this.statusIndicator.classList.add('processing');
                        break;
                    case 'error':
                        this.statusIndicator.style.backgroundColor = '#f44336';
                        break;
                    case 'ready':
                        this.statusIndicator.style.backgroundColor = '#4CAF50';
                        break;
                    default:
                        this.statusIndicator.style.backgroundColor = '#666';
                }
            }
            
            addMessage(message, type, confidence = null) {
                const now = new Date();
                const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}-message`;
                
                let confidenceDisplay = '';
                if (confidence !== null && type === 'user') {
                    const confidencePercent = Math.round(confidence * 100);
                    let confidenceColor = '#4CAF50';
                    if (confidencePercent < 70) confidenceColor = '#FF9800';
                    if (confidencePercent < 50) confidenceColor = '#f44336';
                    
                    confidenceDisplay = `<span style="color: ${confidenceColor}; font-size: 10px; opacity: 0.8;"> (${confidencePercent}%)</span>`;
                }
                
                messageEl.innerHTML = `
                    ${message}${confidenceDisplay}
                    <div class="message-time">${timeString}</div>
                `;
                
                this.conversationEl.appendChild(messageEl);
                this.conversationEl.scrollTop = this.conversationEl.scrollHeight;
                
                // Limita mensagens a 20 para performance
                const messages = this.conversationEl.children;
                if (messages.length > 20) {
                    this.conversationEl.removeChild(messages[0]);
                }
            }
            
            showError(message) {
                this.engineInfo.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
                this.engineInfo.style.background = 'rgba(244, 67, 54, 0.2)';
                this.engineInfo.style.borderColor = 'rgba(244, 67, 54, 0.3)';
                this.updateStatus('‚ùå Erro', 'error');
                this.startBtn.disabled = true;
                this.talkButton.disabled = true;
            }
        }
        
        // Vari√°vel global para permitir acesso aos comandos de teste
        let assistant;
        
        // Inicializa o sistema quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', () => {
            assistant = new OptimizedVoiceRecognition();
            
            setTimeout(() => {
                assistant.addMessage('Bloquito: Sistema otimizado iniciado! Use "Pressionar e Falar" para melhor precis√£o ou teste os comandos clicando neles.', 'bot');
            }, 2000);
        });
    </script>
</body>
</html>
