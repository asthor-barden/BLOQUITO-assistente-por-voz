<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloquito - Assistente de Voz para Celular</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #2c7744 0%, #1e5631 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.12);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        h1 {
            color: #fff;
            font-size: 26px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #FFD700;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .status-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f44336;
        }
        
        .status-indicator.listening {
            background: #4CAF50;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .status-text {
            font-weight: bold;
            font-size: 16px;
        }
        
        .volume-container {
            margin: 15px 0 25px;
        }
        
        .volume-indicator {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
        }
        
        .volume-bar {
            height: 100%;
            background: #FFD700;
            width: 0%;
            transition: width 0.1s ease-out;
            border-radius: 5px;
        }
        
        .volume-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        
        .btn {
            background: #FFD700;
            color: #333;
            border: none;
            padding: 16px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            background: #FFC107;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn.talk {
            background: #FF5722;
            color: white;
            padding: 20px;
            font-size: 18px;
        }
        
        .btn.talk:hover {
            background: #E64A19;
        }
        
        .btn.talk i {
            font-size: 24px;
        }
        
        .conversation {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }
        
        .message {
            margin: 12px 0;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInMessage 0.3s forwards;
            position: relative;
            max-width: 85%;
        }

        @keyframes fadeInMessage {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: linear-gradient(135deg, #1E88E5 0%, #0D47A1 100%);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .commands {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }
        
        .commands h3 {
            margin-top: 0;
            color: #FFD700;
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }
        
        .command-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .permission-info {
            background: rgba(255, 152, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid rgba(255, 152, 0, 0.3);
            text-align: center;
            font-size: 14px;
        }
        
        .permission-info i {
            color: #FFC107;
            margin-right: 8px;
        }
        
        .mic-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Responsividade */
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .btn {
                padding: 14px;
                font-size: 15px;
            }
            
            .btn.talk {
                padding: 18px;
            }
            
            .message {
                font-size: 14px;
                padding: 10px 14px;
            }
            
            .commands-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .command-item {
                font-size: 12px;
                padding: 8px;
            }
        }
        
        @media (max-width: 400px) {
            h1 {
                font-size: 20px;
            }
            
            .subtitle {
                font-size: 12px;
            }
            
            .btn {
                font-size: 14px;
            }
            
            .btn.talk {
                font-size: 16px;
            }
            
            .commands-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <i class="fas fa-microphone mic-icon"></i>
            <h1>Bloquito</h1>
            <div class="subtitle">Assistente de Voz para Celular</div>
        </div>
        
        <div class="permission-info">
            <i class="fas fa-exclamation-circle"></i>
            Para usar, permita o acesso ao microfone quando solicitado
        </div>
        
        <div class="status-container">
            <div class="status-indicator" id="statusIndicator"></div>
            <div class="status-text" id="statusText">Não está ouvindo</div>
        </div>
        
        <div class="volume-container">
            <div class="volume-indicator">
                <div class="volume-bar" id="volumeBar"></div>
            </div>
            <div class="volume-label">
                <span>Baixo</span>
                <span>Alto</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="startBtn">
                <i class="fas fa-play"></i> Iniciar Reconhecimento
            </button>
            <button class="btn" id="stopBtn" disabled>
                <i class="fas fa-stop"></i> Parar Reconhecimento
            </button>
            <button class="btn talk" id="talkButton">
                <i class="fas fa-microphone"></i> Segurar para Falar
            </button>
        </div>

        <div class="conversation" id="conversation">
            <div class="message bot-message">
                Olá! Eu sou o Bloquito. Para começar, toque em "Iniciar Reconhecimento" ou "Segurar para Falar".
            </div>
        </div>
        
        <div class="commands">
            <h3>Comandos Reconhecidos</h3>
            <div class="commands-grid">
                <div class="command-item">Oi / Olá</div>
                <div class="command-item">Bom dia / Boa tarde</div>
                <div class="command-item">Como você está?</div>
                <div class="command-item">Quem é você?</div>
                <div class="command-item">Que horas são?</div>
                <div class="command-item">O que é Bloco+?</div>
                <div class="command-item">O que é STEAMAKER?</div>
                <div class="command-item">Fale sobre o CorelLASER</div>
            </div>
        </div>
    </div>

    <script>
        class VoiceAssistant {
            constructor() {
                this.recognition = null;
                this.isListening = false;
                this.recognitionActiveByUser = false;
                this.audioContext = null;
                this.microphoneStream = null;
                this.analyser = null;
                this.dataArray = null;
                this.beepSound = new Audio();
                
                this.initializeElements();
                this.loadBeepSound();
                this.setupEventListeners();
                this.setupAudioMonitoring();
            }
            
            initializeElements() {
                this.statusIndicator = document.getElementById('statusIndicator');
                this.statusText = document.getElementById('statusText');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.talkButton = document.getElementById('talkButton');
                this.conversationEl = document.getElementById('conversation');
                this.volumeBar = document.getElementById('volumeBar');
            }
            
            loadBeepSound() {
                // Beep curto para feedback
                this.beepSound.src = 'data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';
            }
            
            async setupAudioMonitoring() {
                try {
                    this.microphoneStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.setupSpeechRecognition();
                    
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const source = this.audioContext.createMediaStreamSource(this.microphoneStream);
                    this.analyser = this.audioContext.createAnalyser();
                    
                    this.analyser.fftSize = 256;
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    
                    source.connect(this.analyser);
                    this.monitorAudio();
                } catch (error) {
                    console.error('Erro ao acessar microfone:', error);
                    let errorMessage = 'Erro ao acessar microfone.';
                    if (error.name === 'NotAllowedError') {
                        errorMessage = 'Permissão de microfone negada. Atualize as permissões nas configurações do navegador.';
                        this.statusText.textContent = 'Permissão negada';
                        this.statusIndicator.style.backgroundColor = '#FF9800';
                    }
                    this.addMessage(`Bloquito: ${errorMessage}`, 'bot');
                    this.startBtn.disabled = true;
                    this.talkButton.disabled = true;
                }
            }
            
            monitorAudio() {
                if (!this.analyser) return;
                
                this.analyser.getByteFrequencyData(this.dataArray);
                let sum = 0;
                for (let i = 0; i < this.dataArray.length; i++) {
                    sum += this.dataArray[i];
                }
                const average = sum / this.dataArray.length;
                
                this.volumeBar.style.width = Math.min(average * 2, 100) + '%';
                
                requestAnimationFrame(() => this.monitorAudio());
            }
            
            setupSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.addMessage('Bloquito: Seu navegador não suporta reconhecimento de voz. Use Chrome ou Edge.', 'bot');
                    this.startBtn.disabled = true;
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = 'pt-BR';
                
                this.recognition.onstart = () => this.onStart();
                this.recognition.onresult = (event) => this.onResult(event);
                this.recognition.onerror = (event) => this.onError(event);
                this.recognition.onend = () => this.onEnd();
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.startListening());
                this.stopBtn.addEventListener('click', () => this.stopListening());
                
                this.talkButton.addEventListener('mousedown', () => this.startListening());
                this.talkButton.addEventListener('mouseup', () => this.stopListening());
                
                this.talkButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startListening();
                });
                
                this.talkButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.stopListening();
                });
            }
            
            startListening() {
                if (!this.recognition) return;
                
                this.playBeep();
                this.recognitionActiveByUser = true;
                
                try {
                    this.recognition.start();
                } catch (error) {
                    console.error('Erro ao iniciar reconhecimento:', error);
                    this.addMessage('Bloquito: Não foi possível iniciar o reconhecimento. Tente novamente.', 'bot');
                    this.updateStatus('Erro ao iniciar', 'error');
                }
            }
            
            playBeep() {
                this.beepSound.play().catch(e => console.log('Beep não pode ser reproduzido:', e));
            }
            
            stopListening() {
                if (this.recognition) {
                    this.recognitionActiveByUser = false;
                    this.recognition.stop();
                    this.playBeep();
                }
            }
            
            onStart() {
                this.isListening = true;
                this.updateStatus('Ouvindo...', 'listening');
                this.startBtn.disabled = true;
                this.stopBtn.disabled = false;
                this.talkButton.classList.add('active');
            }
            
            onResult(event) {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                finalTranscript = finalTranscript.trim();
                
                if (finalTranscript) {
                    this.addMessage(`Você: ${finalTranscript}`, 'user');
                    this.processCommand(finalTranscript.toLowerCase());
                }
            }
            
            onError(event) {
                if (event.error !== 'no-speech') {
                    console.error('Erro no reconhecimento:', event.error);
                    
                    let errorMessage = '';
                    switch (event.error) {
                        case 'audio-capture':
                            errorMessage = 'Erro ao capturar áudio. Verifique o microfone.';
                            break;
                        case 'not-allowed':
                            errorMessage = 'Permissão de microfone negada. Atualize as permissões.';
                            break;
                        case 'network':
                            errorMessage = 'Erro de rede. Verifique sua conexão.';
                            break;
                        default:
                            errorMessage = `Erro: ${event.error}`;
                    }
                    
                    this.addMessage(`Bloquito: ${errorMessage}`, 'bot');
                    this.updateStatus('Erro', 'error');
                }
            }
            
            onEnd() {
                this.isListening = false;
                this.updateStatus('Não está ouvindo', 'not-listening');
                this.startBtn.disabled = false;
                this.stopBtn.disabled = true;
                this.talkButton.classList.remove('active');
                
                if (this.recognitionActiveByUser) {
                    setTimeout(() => {
                        if (this.recognitionActiveByUser) {
                            this.startListening();
                        }
                    }, 500);
                }
            }
            
            processCommand(command) {
                let response = '';
                const normalizedCommand = this.normalizeText(command);
                const now = new Date();
                const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');

                // Comandos gerais
                if (normalizedCommand.includes('oi') || normalizedCommand.includes('ola') || 
                    normalizedCommand.includes('bom dia') || normalizedCommand.includes('boa tarde') || 
                    normalizedCommand.includes('boa noite')) {
                    response = 'Olá! Como posso te ajudar?';
                } 
                else if (normalizedCommand.includes('tudo bem') || normalizedCommand.includes('como vai') || 
                         normalizedCommand.includes('voce esta bem')) {
                    response = 'Estou bem, obrigado! E você?';
                } 
                else if (normalizedCommand.includes('quem e voce') || normalizedCommand.includes('como e seu nome') || 
                         normalizedCommand.includes('fale sobre voce') || normalizedCommand.includes('qual seu nome')) {
                    response = 'Eu sou o Bloquito, seu assistente de voz especializado em kits educacionais da Asthor Barden!';
                } 
                else if (normalizedCommand.includes('que horas') || normalizedCommand.includes('horas sao')) {
                    response = `Agora são ${timeString}.`;
                } 
                else if (normalizedCommand.includes('parar') || normalizedCommand.includes('pare')) {
                    response = 'Parando o reconhecimento. Até mais!';
                    this.stopListening();
                }
                // Perguntas específicas
                else if (normalizedCommand.includes('o que e bloco mais') || 
                         normalizedCommand.includes('fale sobre o bloco mais')) {
                    response = 'O Bloco+ é um kit de eletrônica pedagógica com componentes em blocos, facilitando conexões físicas. Focado em robótica, automação e eletrônica básica.';
                } 
                else if (normalizedCommand.includes('o que e steamaker')) {
                    response = 'O STEAMAKER é um kit similar ao Bloco+, mas com componentes organizados em módulos para maior flexibilidade.';
                } 
                else if (normalizedCommand.includes('bloco mais bot')) {
                    response = 'O Bloco+Bot é o microcontrolador central do kit, com ESP32, sensores e capacidade de controlar motores e LEDs.';
                } 
                else if (normalizedCommand.includes('corellaser')) {
                    response = 'O CorelLASER é um programa para controle de máquinas de corte a laser, usado em conjunto com os kits Asthor Barden.';
                }
                // Fallback
                else {
                    response = 'Desculpe, não entendi. Posso ajudar com informações sobre Bloco+, STEAMAKER ou outros produtos da Asthor Barden?';
                }

                if (response) {
                    setTimeout(() => {
                        this.addMessage(`Bloquito: ${response}`, 'bot');
                        this.speak(response);
                    }, 500);
                }
            }
            
            normalizeText(text) {
                return text
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^\w\s]/gi, '');
            }
            
            speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    
                    // Para o reconhecimento durante a fala
                    if (this.recognition && this.isListening) {
                        this.recognition.stop();
                    }
                    
                    utterance.onend = () => {
                        // Reinicia o reconhecimento se o usuário ainda estiver ativo
                        if (this.recognitionActiveByUser) {
                            setTimeout(() => {
                                if (this.recognitionActiveByUser) {
                                    this.startListening();
                                }
                            }, 300);
                        }
                    };
                    
                    speechSynthesis.speak(utterance);
                }
            }
            
            updateStatus(message, state) {
                this.statusText.textContent = message;
                
                if (state === 'listening') {
                    this.statusIndicator.className = 'status-indicator listening';
                } else if (state === 'error') {
                    this.statusIndicator.style.backgroundColor = '#FF9800';
                    this.statusIndicator.style.animation = 'none';
                } else {
                    this.statusIndicator.className = 'status-indicator';
                    this.statusIndicator.style.backgroundColor = '#f44336';
                }
            }
            
            addMessage(message, type) {
                const now = new Date();
                const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}-message`;
                messageEl.innerHTML = `
                    ${message}
                    <div class="message-time">${timeString}</div>
                `;
                
                this.conversationEl.appendChild(messageEl);
                this.conversationEl.scrollTop = this.conversationEl.scrollHeight;
            }
        }
        
        // Inicializa o assistente quando a página carrega
        document.addEventListener('DOMContentLoaded', () => {
            const assistant = new VoiceAssistant();
            
            // Adiciona mensagem de boas-vindas após um breve delay
            setTimeout(() => {
                assistant.addMessage('Bloquito: Estou pronto para ajudar! Faça uma pergunta sobre nossos produtos.', 'bot');
            }, 1000);
        });
    </script>
</body>
</html>
